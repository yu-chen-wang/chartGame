<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <link rel="stylesheet" type="text/css" href="styles\reset.css">

    <script src="scripts\jquery-3.3.1.min.js" type="text/javascript"></script>

    <script>
        $(document).ready(function () {

            //let url = 'http://192.168.10.148/CmMannaWCF/IsHoliday?date8=' + date + '&ck=936DA01F-9ABD-4d9d-80C7-02AF85C822A8';
            let url = 'http://192.168.10.148/TickDbData/api/tick/get?time=2017/05/02';

            let dateIsHoliday = true;

            let date = getRandomDate();
            //console.log("date:", date);

            // 確認日期是否為假日
            $.ajax({
                url: 'callApi.php',
                type: 'GET',
                data: { method: 'GET', url: 'http://192.168.10.148/CmMannaWCF/IsHoliday?date8=' + date + '&ck=936DA01F-9ABD-4d9d-80C7-02AF85C822A8', data: false },
                error: function (error) {
                    console.log(error);
                },
                success: function (result) {
                    dateIsHoliday = result;
                    console.log("dateIsHoliday:", dateIsHoliday);
                    console.log(date);
                    console.log(result);

                    if (dateIsHoliday === 'false') {
                        getTickData();
                    }


                }

            })

            // 取得期貨資料
            // @param date 欲取得期貨的日期
            // @return 期貨資料
            function getTickData(date) {
                $.ajax({
                    url: 'callApi.php',
                    type: 'GET',
                    data: { method: 'GET', url: 'http://192.168.10.148/TickDbData/api/tick/get?time=' + '2017/05/02', data: false },
                    type: 'GET',
                    error: function (error) {
                        console.log(error);
                    },
                    success: function (result) {
                        let data = JSON.parse(result);

                        console.log(data);
                    }

                })
            }

            // 取得亂數日期 從 2016 ~ 昨天 (當天還沒有期貨資料)
            function getRandomDate() {
                let date = new Date();
                let yearMin = 2016;
                let yearMax = date.getFullYear();
                let monthMin = 1;
                let monthMax = 12;

                let year = Math.floor(Math.random() * (yearMax - yearMin + 1)) + yearMin;

                if (year == yearMax) {
                    monthMax = date.getMonth();
                }

                let month = Math.floor(Math.random() * (monthMax - monthMin + 1)) + monthMin;

                // 亂數出的月份天數
                let dayMax = new Date(year, month, 0).getDate();
                let dayMin = 1;

                if (month == monthMax) {
                    dayMax--;
                }

                let day = Math.floor(Math.random() * (dayMax - dayMin + 1)) + dayMin;

                if (month < 10) {
                    month = '0' + month;
                }

                if (day < 10) {
                    day = '0' + day;
                }

                let result = year.toString() + month.toString() + day.toString();
                //console.log(result);

                return result;

            }

        });




    </script>

    <title>對戰</title>
</head>

<body>


    <script>



    </script>





</body>

</html>