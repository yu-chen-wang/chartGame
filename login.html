<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <!-- <link rel="stylesheet" type="text/css" href="styles\reset.css"> -->

    <!-- jquery -->
    <script src="scripts\jquery-3.3.1.min.js" type="text/javascript"></script>

    <!-- jquery md5 -->
    <script src="scripts\jQuery.md5.js" type="text/javascript"></script>

    <script>

        $(document).ready(function () {

            $("#login").click(function () {
                let account = $("#account").val();
                let password = $("#password").val();

                password = $.md5(password);

                // 登入 API 資料
                let loginData = {
                    Action: 'getloginguid',
                    Account: account,
                    token: 'text',
                    Password: password,
                    Appid: 20,
                    Device: 2,
                    isNeedPush: false
                }

                let guid = getGuid(loginData);

                // 取得會員資訊 API 資料
                let memberData = {
                    Action: 'getmemberprofile',
                    Guid: guid
                }

                let userProfile = getUserinfo(memberData);

                let nickName = userProfile.NickName;
                let imagePath = userProfile.ImagePath;

                // 取得 PlayerID API 資料
                let user = {
                    GUID: guid,
                    NickName: nickName,
                    ImagePath: imagePath
                }

                // console.log("user:", user);

                let playerID = getPlayerID(user);
                console.log("playerID:", playerID);


                // 取得會員 guid
                // return guid
                function getGuid(data) {

                    let result;

                    $.ajax({
                        url: 'callApi.php',
                        type: 'POST',
                        async: false,
                        data: { method: 'POST', url: 'http://www.cmoney.tw/MobileService/ashx/LoginCheck/LoginCheck.ashx', data: data },
                        error: function (error) {
                            console.log(error);
                        },
                        success: function (response) {
                            result = JSON.parse(response).Guid;
                        }

                    })

                    return result;
                }

                // 取得會員資訊
                // return memberProfile
                function getUserinfo(data) {

                    let result;

                    $.ajax({
                        url: 'callApi.php',
                        type: 'POST',
                        async: false,
                        data: { method: 'POST', url: 'http://www.cmoney.tw/MobileService/ashx/LoginCheck/LoginCheck.ashx', data: data },
                        error: function (error) {
                            console.log(error);
                        },
                        success: function (response) {
                            result = JSON.parse(response);
                        }

                    })

                    return result;
                }

                // 取得 PlayerID
                function getPlayerID(data) {
                    console.log("user data:", data);
                    let result;

                    $.ajax({
                        url: 'callApi.php',
                        type: 'POST',
                        async: false,
                        data: { method: 'POST', url: 'http://192.168.10.148/ChartGame/api/UserInfo/UpdateOrCreateUser', data: data },
                        error: function (error) {
                            console.log(error);
                        },
                        success: function (response) {
                            console.log("response", response);
                            // result = JSON.parse(response);
                        }

                    })

                    return result;
                }

            })


        });


    </script>


    <title>登入</title>
</head>

<body>

    <p>CMoney</p>
    <p>王牌操盤手</p>

    帳號 <input type="email" id="account" required><br>
    密碼 <input type="password" id="password" required><br>

    <input type="button" value="註冊"> <input type="button" value="忘記密碼"> <input type="checkbox"> <input type="button"
        value="記住密碼"><br>

    <input type="button" id="login" value="登入">

</body>

</html>